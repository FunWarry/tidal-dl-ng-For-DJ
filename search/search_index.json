{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"tidal-dl-ng","text":"<p>tidal-dl-ng</p>"},{"location":"delimiters_category/","title":"\"Delimiters\" Category","text":""},{"location":"delimiters_category/#goal","title":"Goal","text":"<p>Allow users to customize separators used for artists and album artists, both in metadata and filenames.</p>"},{"location":"delimiters_category/#parameters","title":"Parameters","text":"<ul> <li><code>metadata_delimiter_artist</code>: artists separator (metadata)</li> <li><code>metadata_delimiter_album_artist</code>: album artists separator (metadata)</li> <li><code>filename_delimiter_artist</code>: artists separator (filename)</li> <li><code>filename_delimiter_album_artist</code>: album artists separator (filename)</li> </ul>"},{"location":"delimiters_category/#ui","title":"UI","text":"<ul> <li>Page <code>page_delimiters</code> inside <code>sw_categories</code></li> <li>GroupBox <code>gb_delimiters</code></li> <li>4 <code>QLineEdit</code> entries (<code>le_*</code>) with max width 100px</li> </ul>"},{"location":"delimiters_category/#integration","title":"Integration","text":"<ul> <li>Add the 4 fields to <code>DialogPreferences.parameters_line_edit</code></li> <li>Load values via <code>populate_line_edit()</code></li> <li>Save via <code>to_settings()</code></li> </ul>"},{"location":"delimiters_category/#tests","title":"Tests","text":"<ul> <li><code>tests/test_delimiters_category.py</code>: 13 tests</li> <li>Page existence</li> <li>Widgets accessibility</li> <li>Navigation to the page</li> <li>Width constraints</li> </ul>"},{"location":"delimiters_category/#examples","title":"Examples","text":"<ul> <li>Semicolon: <code>\"; \"</code> \u2192 <code>Artist1; Artist2</code></li> <li>Ampersand: <code>\" &amp; \"</code> \u2192 <code>Artist1 &amp; Artist2</code></li> <li>Slash: <code>\" / \"</code> \u2192 <code>Artist1 / Artist2</code></li> </ul>"},{"location":"delimiters_category/#notes","title":"Notes","text":"<ul> <li>Default values are <code>\", \"</code> (comma + space)</li> <li>Fields are kept short (max 100px) to avoid breaking the layout</li> </ul>"},{"location":"dl_history_%26_duplicate_prev/","title":"Download History Tracking &amp; Duplicate Prevention Feature","text":""},{"location":"dl_history_%26_duplicate_prev/#overview","title":"Overview","text":"<p>This feature adds comprehensive download history tracking with duplicate prevention capabilities to tidal-dl-ng. It provides users with visual feedback about previously downloaded tracks and the ability to prevent redundant downloads through a persistent JSON-based history system.</p>"},{"location":"dl_history_%26_duplicate_prev/#table-of-contents","title":"Table of Contents","text":"<ol> <li>Features</li> <li>Architecture</li> <li>Implementation Details</li> <li>User Interface</li> <li>File Structure</li> <li>API Reference</li> <li>Testing</li> <li>Usage Examples</li> </ol>"},{"location":"dl_history_%26_duplicate_prev/#features","title":"Features","text":""},{"location":"dl_history_%26_duplicate_prev/#core-functionality","title":"Core Functionality","text":"<ul> <li>Persistent Download History: Tracks all downloaded tracks in a JSON file that persists across application restarts</li> <li>Duplicate Prevention: Automatically skips tracks that have already been downloaded (when enabled)</li> <li>Toggle Control: Users can enable/disable duplicate prevention via GUI menu</li> <li>Source Tracking: Records the source of each download (playlist, album, mix, manual)</li> <li>Thread-Safe Operations: All history operations are thread-safe for concurrent downloads</li> <li>Atomic File Operations: Prevents corruption through atomic write operations</li> <li>Import/Export: Allows users to backup and restore their download history</li> <li>Statistics: Provides insights into download history (total tracks, by source type, dates)</li> <li>Visual Feedback: Console messages are color-coded (green) for better visibility</li> </ul>"},{"location":"dl_history_%26_duplicate_prev/#user-benefits","title":"User Benefits","text":"<ul> <li>\u2705 Avoid wasting bandwidth on duplicate downloads</li> <li>\u2705 Keep track of what has been downloaded</li> <li>\u2705 Quickly identify already-downloaded content</li> <li>\u2705 Portable history through import/export</li> <li>\u2705 Source-based organization of download history</li> </ul>"},{"location":"dl_history_%26_duplicate_prev/#architecture","title":"Architecture","text":""},{"location":"dl_history_%26_duplicate_prev/#design-pattern-singleton","title":"Design Pattern: Singleton","text":"<p>The <code>HistoryService</code> uses the Singleton pattern to ensure only one instance manages the download history throughout the application lifecycle.</p> <pre><code>class HistoryService(metaclass=SingletonMeta):\n    \"\"\"Single instance managing all download history operations\"\"\"\n</code></pre>"},{"location":"dl_history_%26_duplicate_prev/#data-structure-track-centric","title":"Data Structure: Track-Centric","text":"<p>The history uses a track-centric approach with track IDs as keys for O(1) lookup performance:</p> <pre><code>{\n  \"settings\": {\n    \"preventDuplicates\": true\n  },\n  \"tracks\": {\n    \"track_id\": {\n      \"sourceType\": \"playlist\",\n      \"sourceId\": \"pl-uuid\",\n      \"sourceName\": \"Playlist Name\",\n      \"downloadDate\": \"2025-11-29T12:34:56.789Z\"\n    }\n  }\n}\n</code></pre>"},{"location":"dl_history_%26_duplicate_prev/#thread-safety","title":"Thread Safety","text":"<p>All critical operations are protected by a <code>threading.Lock</code>:</p> <pre><code>with self._lock:\n    # Critical section - atomic operations\n    self.history_data[track_id] = entry\n    self._save_history_internal()\n</code></pre>"},{"location":"dl_history_%26_duplicate_prev/#implementation-details","title":"Implementation Details","text":""},{"location":"dl_history_%26_duplicate_prev/#1-history-service-tidal_dl_nghistorypy","title":"1. History Service (<code>tidal_dl_ng/history.py</code>)","text":"<p>File: <code>tidal_dl_ng/history.py</code> (new file, ~550 lines)</p> <p>Purpose: Central service for managing download history with JSON persistence.</p>"},{"location":"dl_history_%26_duplicate_prev/#key-methods","title":"Key Methods","text":""},{"location":"dl_history_%26_duplicate_prev/#add_track_to_history","title":"<code>add_track_to_history()</code>","text":"<pre><code>def add_track_to_history(\n    self,\n    track_id: str,\n    source_type: str = \"manual\",\n    source_id: str | None = None,\n    source_name: str | None = None\n) -&gt; None:\n    \"\"\"Add a track to download history with source metadata.\"\"\"\n</code></pre>"},{"location":"dl_history_%26_duplicate_prev/#should_skip_download","title":"<code>should_skip_download()</code>","text":"<pre><code>def should_skip_download(self, track_id: str) -&gt; bool:\n    \"\"\"\n    Determine if a track should be skipped based on:\n    1. Track exists in history\n    2. Duplicate prevention is enabled\n\n    Returns True if both conditions are met.\n    \"\"\"\n</code></pre>"},{"location":"dl_history_%26_duplicate_prev/#update_settings","title":"<code>update_settings()</code>","text":"<pre><code>def update_settings(self, **kwargs: Any) -&gt; None:\n    \"\"\"Update settings and persist immediately to JSON.\"\"\"\n</code></pre>"},{"location":"dl_history_%26_duplicate_prev/#atomic-write-implementation","title":"Atomic Write Implementation","text":"<pre><code>def _save_history_internal(self) -&gt; None:\n    \"\"\"\n    Atomic write pattern:\n    1. Write to temporary file\n    2. Atomic rename (os.replace on Windows)\n    3. Cleanup on error\n    \"\"\"\n    with tempfile.NamedTemporaryFile(...) as tmp_file:\n        json.dump(data, tmp_file)\n        tmp_path = tmp_file.name\n\n    os.replace(tmp_path, self.file_path)  # Atomic operation\n</code></pre>"},{"location":"dl_history_%26_duplicate_prev/#corruption-recovery","title":"Corruption Recovery","text":"<pre><code>try:\n    data = json.load(f)\nexcept (json.JSONDecodeError, ValueError):\n    # Create backup of corrupted file\n    backup_path = self.file_path.with_suffix(\".json.bak\")\n    shutil.copy2(self.file_path, backup_path)\n    # Start fresh\n    self.history_data = {}\n</code></pre>"},{"location":"dl_history_%26_duplicate_prev/#2-download-integration-tidal_dl_ngdownloadpy","title":"2. Download Integration (<code>tidal_dl_ng/download.py</code>)","text":"<p>Modifications: Integration points in existing download flow</p>"},{"location":"dl_history_%26_duplicate_prev/#pre-download-check","title":"Pre-Download Check","text":"<pre><code>def item(self, ...) -&gt; tuple[bool, pathlib.Path | str]:\n    # Step 2b: Duplicate prevention\n    if isinstance(media, Track):\n        track_id = str(media.id)\n        if self.history_service.should_skip_download(track_id):\n            self.fn_logger.info(\n                f\"Skipped item '{name_builder_item(media)}' (already in history).\"\n            )\n            return False, path_media_dst\n</code></pre>"},{"location":"dl_history_%26_duplicate_prev/#post-download-recording","title":"Post-Download Recording","text":"<pre><code># Step 6: Add to history after successful download\nif download_success and isinstance(media, Track):\n    try:\n        self.history_service.add_track_to_history(\n            track_id=str(media.id),\n            source_type=source_type,\n            source_id=source_id,\n            source_name=source_name\n        )\n    except Exception as e:\n        self.fn_logger.warning(f\"Failed to add track to history: {e}\")\n</code></pre> <p>Note: Videos are intentionally excluded from history tracking as they use a different workflow.</p>"},{"location":"dl_history_%26_duplicate_prev/#3-gui-integration-tidal_dl_ngguipy","title":"3. GUI Integration (<code>tidal_dl_ng/gui.py</code>)","text":"<p>Modifications: Tools menu integration</p>"},{"location":"dl_history_%26_duplicate_prev/#menu-action-creation","title":"Menu Action Creation","text":"<pre><code>def _init_menu_actions(self) -&gt; None:\n    \"\"\"Initialize custom menu actions.\"\"\"\n    # Create or find Tools menu\n    tools_menu = self._get_or_create_tools_menu()\n\n    # Add View History action\n    self.a_view_history = QtGui.QAction(\"View Download History...\", self)\n    self.a_view_history.triggered.connect(self.on_view_history)\n    tools_menu.addAction(self.a_view_history)\n\n    # Add separator\n    tools_menu.addSeparator()\n\n    # Add duplicate prevention toggle\n    self.a_toggle_duplicate_prevention = QtGui.QAction(\n        \"Prevent Duplicate Downloads\", self\n    )\n    self.a_toggle_duplicate_prevention.setCheckable(True)\n    is_preventing = self.history_service.get_settings().get(\"preventDuplicates\", True)\n    self.a_toggle_duplicate_prevention.setChecked(is_preventing)\n    self.a_toggle_duplicate_prevention.triggered.connect(\n        self.on_toggle_duplicate_prevention\n    )\n    tools_menu.addAction(self.a_toggle_duplicate_prevention)\n</code></pre>"},{"location":"dl_history_%26_duplicate_prev/#toggle-handler","title":"Toggle Handler","text":"<pre><code>def on_toggle_duplicate_prevention(self, enabled: bool) -&gt; None:\n    \"\"\"Toggle duplicate download prevention on or off.\n\n    Args:\n        enabled: Whether duplicate prevention is enabled.\n    \"\"\"\n    self.history_service.update_settings(preventDuplicates=enabled)\n    status_msg = \"enabled\" if enabled else \"disabled\"\n    logger_gui.info(f\"Duplicate download prevention {status_msg}\")\n    self.s_statusbar_message.emit(\n        StatusbarMessage(\n            message=f\"Duplicate prevention {status_msg}.\",\n            timeout=2500\n        )\n    )\n</code></pre>"},{"location":"dl_history_%26_duplicate_prev/#4-logger-configuration-tidal_dl_ngloggerpy","title":"4. Logger Configuration (<code>tidal_dl_ng/logger.py</code>)","text":"<p>Modifications: Color configuration for INFO messages</p>"},{"location":"dl_history_%26_duplicate_prev/#problem","title":"Problem","text":"<p>By default, <code>coloredlogs</code> doesn't apply any color to INFO level messages (<code>'info': {}</code>), making them appear gray and less visible.</p>"},{"location":"dl_history_%26_duplicate_prev/#solution","title":"Solution","text":"<pre><code># Configure custom level styles to make INFO messages green\nlevel_styles = coloredlogs.DEFAULT_LEVEL_STYLES.copy()\nlevel_styles['info'] = {'color': 'green'}\n\nformatter = coloredlogs.ColoredFormatter(\n    fmt=log_fmt,\n    level_styles=level_styles\n)\n</code></pre>"},{"location":"dl_history_%26_duplicate_prev/#result","title":"Result","text":"<p>All INFO messages (including skip messages) now display in green in the application console:</p> <pre><code>&gt; Downloaded item 'Track Name'.          # Green\n&gt; Skipped item 'Track Name' (already in history).  # Green\n&gt; Finished list 'Playlist Name'.         # Green\n</code></pre>"},{"location":"dl_history_%26_duplicate_prev/#user-interface","title":"User Interface","text":""},{"location":"dl_history_%26_duplicate_prev/#tools-menu","title":"Tools Menu","text":"<p>Location: Menu Bar \u2192 Tools</p> <p>Structure:</p> <pre><code>Tools\n\u251c\u2500\u2500 View Download History...\n\u251c\u2500\u2500 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\u2514\u2500\u2500 \u2611 Prevent Duplicate Downloads\n</code></pre>"},{"location":"dl_history_%26_duplicate_prev/#menu-actions","title":"Menu Actions","text":""},{"location":"dl_history_%26_duplicate_prev/#1-view-download-history","title":"1. View Download History...","text":"<p>Opens the Download History dialog showing:</p> <ul> <li>All downloaded tracks</li> <li>Grouped by source (playlists, albums, mixes)</li> <li>Download dates and metadata</li> <li>Import/Export buttons</li> <li>Clear history option</li> </ul>"},{"location":"dl_history_%26_duplicate_prev/#2-prevent-duplicate-downloads-checkable","title":"2. Prevent Duplicate Downloads (Checkable)","text":"<ul> <li>Checked (Default): Tracks in history will be automatically skipped</li> <li>Unchecked: Allows re-downloading tracks even if in history</li> <li>State is persisted to JSON file</li> <li>Immediate effect on download behavior</li> <li>Status message displayed in status bar</li> </ul>"},{"location":"dl_history_%26_duplicate_prev/#console-messages","title":"Console Messages","text":""},{"location":"dl_history_%26_duplicate_prev/#downloaded-item-success","title":"Downloaded Item (Success)","text":"<pre><code>&gt; Downloaded item 'Artist - Track Title'.\n</code></pre> <p>Color: Green</p>"},{"location":"dl_history_%26_duplicate_prev/#skipped-item-duplicate","title":"Skipped Item (Duplicate)","text":"<pre><code>&gt; Skipped item 'Artist - Track Title' (already in history).\n</code></pre> <p>Color: Green</p>"},{"location":"dl_history_%26_duplicate_prev/#list-finished","title":"List Finished","text":"<pre><code>&gt; Finished list 'Playlist Name'.\n</code></pre> <p>Color: Green</p>"},{"location":"dl_history_%26_duplicate_prev/#file-structure","title":"File Structure","text":""},{"location":"dl_history_%26_duplicate_prev/#json-file-location","title":"JSON File Location","text":"<p>Path: <code>{config_base}/downloaded_history.json</code></p> <p>Config Base Locations:</p> <ul> <li>Windows: <code>%APPDATA%\\tidal-dl-ng\\</code></li> <li>macOS: <code>~/Library/Application Support/tidal-dl-ng/</code></li> <li>Linux: <code>~/.config/tidal-dl-ng/</code></li> </ul>"},{"location":"dl_history_%26_duplicate_prev/#json-schema","title":"JSON Schema","text":""},{"location":"dl_history_%26_duplicate_prev/#version-1-current","title":"Version 1 (Current)","text":"<pre><code>{\n  \"_schema_version\": 1,\n  \"_last_updated\": \"2025-11-29T12:34:56.789Z\",\n  \"settings\": {\n    \"preventDuplicates\": true\n  },\n  \"tracks\": {\n    \"123456\": {\n      \"sourceType\": \"playlist\",\n      \"sourceId\": \"uuid-123-456\",\n      \"sourceName\": \"My Awesome Playlist\",\n      \"downloadDate\": \"2025-11-29T12:30:00.000Z\"\n    },\n    \"789012\": {\n      \"sourceType\": \"album\",\n      \"sourceId\": \"uuid-789-012\",\n      \"sourceName\": \"Amazing Album\",\n      \"downloadDate\": \"2025-11-29T12:35:00.000Z\"\n    }\n  }\n}\n</code></pre>"},{"location":"dl_history_%26_duplicate_prev/#field-descriptions","title":"Field Descriptions","text":"Field Type Description <code>_schema_version</code> integer Schema version for future migrations <code>_last_updated</code> ISO 8601 Last modification timestamp <code>settings.preventDuplicates</code> boolean Enable/disable duplicate prevention <code>tracks</code> object Map of track_id \u2192 track metadata <code>tracks[id].sourceType</code> string Source type: \"playlist\", \"album\", \"mix\", \"manual\", \"track\" <code>tracks[id].sourceId</code> string|null UUID of source, null for manual <code>tracks[id].sourceName</code> string|null Display name of source <code>tracks[id].downloadDate</code> ISO 8601 When the track was downloaded"},{"location":"dl_history_%26_duplicate_prev/#legacy-format-migration","title":"Legacy Format Migration","text":"<p>The service automatically migrates from the legacy format (tracks at root level):</p> <pre><code>{\n  \"_schema_version\": 1,\n  \"123456\": {\n    \"sourceType\": \"playlist\",\n    ...\n  }\n}\n</code></pre> <p>to the new format with separate <code>settings</code> and <code>tracks</code> sections.</p>"},{"location":"dl_history_%26_duplicate_prev/#api-reference","title":"API Reference","text":""},{"location":"dl_history_%26_duplicate_prev/#historyservice","title":"HistoryService","text":""},{"location":"dl_history_%26_duplicate_prev/#initialization","title":"Initialization","text":"<pre><code>from tidal_dl_ng.history import HistoryService\n\nhistory = HistoryService()  # Singleton - always returns same instance\n</code></pre>"},{"location":"dl_history_%26_duplicate_prev/#core-methods","title":"Core Methods","text":""},{"location":"dl_history_%26_duplicate_prev/#track-operations","title":"Track Operations","text":"<pre><code># Add track to history\nhistory.add_track_to_history(\n    track_id=\"123456\",\n    source_type=\"playlist\",\n    source_id=\"pl-uuid\",\n    source_name=\"My Playlist\"\n)\n\n# Check if track is downloaded\nis_downloaded = history.is_downloaded(\"123456\")  # Returns bool\n\n# Get track information\ninfo = history.get_track_info(\"123456\")  # Returns dict or None\n\n# Remove track from history\nremoved = history.remove_track_from_history(\"123456\")  # Returns bool\n</code></pre>"},{"location":"dl_history_%26_duplicate_prev/#duplicate-prevention","title":"Duplicate Prevention","text":"<pre><code># Check if download should be skipped\nshould_skip = history.should_skip_download(\"123456\")\n# Returns True if:\n# 1. Track exists in history AND\n# 2. preventDuplicates setting is enabled\n\n# Update duplicate prevention setting\nhistory.update_settings(preventDuplicates=True)  # or False\n</code></pre>"},{"location":"dl_history_%26_duplicate_prev/#settings-management","title":"Settings Management","text":"<pre><code># Get current settings\nsettings = history.get_settings()\n# Returns: {\"preventDuplicates\": bool}\n\n# Update settings\nhistory.update_settings(preventDuplicates=False)\n# Immediately persists to JSON\n</code></pre>"},{"location":"dl_history_%26_duplicate_prev/#data-views","title":"Data Views","text":"<pre><code># Get history grouped by source\nby_source = history.get_history_by_source()\n# Returns: {\n#   \"playlist_uuid-123\": [track_info, ...],\n#   \"album_uuid-456\": [track_info, ...],\n#   \"manual_manual\": [track_info, ...]\n# }\n\n# Get statistics\nstats = history.get_statistics()\n# Returns: {\n#   \"total_tracks\": int,\n#   \"by_source_type\": {\"playlist\": 10, \"album\": 5, ...},\n#   \"oldest_download\": \"ISO 8601\",\n#   \"newest_download\": \"ISO 8601\"\n# }\n</code></pre>"},{"location":"dl_history_%26_duplicate_prev/#importexport","title":"Import/Export","text":"<pre><code># Export history\nsuccess, message = history.export_history(\"/path/to/export.json\")\n# Returns: (True, \"Successfully exported N tracks\") or (False, \"Error message\")\n\n# Import history (merge mode)\nsuccess, message = history.import_history(\"/path/to/import.json\", merge=True)\n# merge=True: Adds to existing history\n# merge=False: Replaces existing history\n\n# Clear all history\nhistory.clear_history()  # Destructive - removes all tracks\n</code></pre>"},{"location":"dl_history_%26_duplicate_prev/#utilities","title":"Utilities","text":"<pre><code># Get history file path\npath = history.get_history_file_path()\n# Returns: \"/path/to/downloaded_history.json\"\n\n# Save history manually (usually not needed)\nhistory.save_history()  # Most methods auto-save\n</code></pre>"},{"location":"dl_history_%26_duplicate_prev/#testing","title":"Testing","text":""},{"location":"dl_history_%26_duplicate_prev/#test-coverage","title":"Test Coverage","text":"<p>Total: 91 tests across 4 test files</p>"},{"location":"dl_history_%26_duplicate_prev/#test-files","title":"Test Files","text":"<ol> <li> <p>test_history_service.py (38 tests)</p> </li> <li> <p>Service initialization</p> </li> <li>CRUD operations on tracks</li> <li>Duplicate prevention logic</li> <li>Settings management</li> <li>JSON persistence and corruption recovery</li> <li>Import/Export functionality</li> <li>Statistics calculation</li> <li> <p>Thread safety</p> </li> <li> <p>test_download_duplicate_prevention.py (10 tests)</p> </li> <li> <p>Download skip logic</p> </li> <li>History integration</li> <li>Log message formatting</li> <li>Post-download history updates</li> <li> <p>Settings toggle effects</p> </li> <li> <p>test_gui_duplicate_prevention.py (22 tests)</p> </li> <li> <p>Menu creation and structure</p> </li> <li>Action state management</li> <li>Handler behavior</li> <li>Settings persistence</li> <li> <p>Status messages</p> </li> <li> <p>test_logger_configuration.py (20 tests)</p> </li> <li>Color configuration</li> <li>Formatter setup</li> <li>Message formatting</li> <li>coloredlogs integration</li> </ol>"},{"location":"dl_history_%26_duplicate_prev/#running-tests","title":"Running Tests","text":"<pre><code># All tests\npytest tests/ -v\n\n# Specific test file\npytest tests/test_history_service.py -v\n\n# With coverage\npytest tests/ --cov=tidal_dl_ng --cov-report=html\n\n# Specific test class\npytest tests/test_history_service.py::TestDuplicatePrevention -v\n</code></pre>"},{"location":"dl_history_%26_duplicate_prev/#test-results","title":"Test Results","text":"<pre><code>======================== 91 passed in 0.91s ========================\n\u2705 test_history_service.py: 38 passed\n\u2705 test_download_duplicate_prevention.py: 10 passed\n\u2705 test_gui_duplicate_prevention.py: 22 passed\n\u2705 test_logger_configuration.py: 20 passed\n</code></pre>"},{"location":"dl_history_%26_duplicate_prev/#usage-examples","title":"Usage Examples","text":""},{"location":"dl_history_%26_duplicate_prev/#example-1-basic-download-with-history","title":"Example 1: Basic Download with History","text":"<pre><code>from tidal_dl_ng.download import Download\nfrom tidal_dl_ng.history import HistoryService\n\n# Initialize download service\ndownload = Download(...)\n\n# Download a track (automatic history tracking)\nsuccess, path = download.item(\n    file_template=\"{artist_name} - {track_title}\",\n    media=track,\n    source_type=\"playlist\",\n    source_id=\"pl-uuid-123\",\n    source_name=\"My Playlist\"\n)\n\n# Track is automatically added to history if successful\n\n# Check if track was downloaded\nhistory = HistoryService()\nif history.is_downloaded(str(track.id)):\n    print(\"Track is in history!\")\n</code></pre>"},{"location":"dl_history_%26_duplicate_prev/#example-2-preventing-duplicates","title":"Example 2: Preventing Duplicates","text":"<pre><code>from tidal_dl_ng.history import HistoryService\n\nhistory = HistoryService()\n\n# Enable duplicate prevention (default)\nhistory.update_settings(preventDuplicates=True)\n\n# Check before downloading\ntrack_id = \"123456\"\nif history.should_skip_download(track_id):\n    print(f\"Track {track_id} already downloaded - skipping\")\nelse:\n    # Proceed with download\n    download.item(...)\n</code></pre>"},{"location":"dl_history_%26_duplicate_prev/#example-3-exporting-history-for-backup","title":"Example 3: Exporting History for Backup","text":"<pre><code>from tidal_dl_ng.history import HistoryService\n\nhistory = HistoryService()\n\n# Export current history\nsuccess, message = history.export_history(\"/backup/my_history.json\")\nif success:\n    print(f\"\u2705 {message}\")\nelse:\n    print(f\"\u274c {message}\")\n\n# Later, import it back\nsuccess, message = history.import_history(\n    \"/backup/my_history.json\",\n    merge=True  # Merge with existing\n)\n</code></pre>"},{"location":"dl_history_%26_duplicate_prev/#example-4-getting-download-statistics","title":"Example 4: Getting Download Statistics","text":"<pre><code>from tidal_dl_ng.history import HistoryService\n\nhistory = HistoryService()\n\n# Get statistics\nstats = history.get_statistics()\n\nprint(f\"Total tracks downloaded: {stats['total_tracks']}\")\nprint(f\"By source type:\")\nfor source_type, count in stats['by_source_type'].items():\n    print(f\"  {source_type}: {count}\")\nprint(f\"Oldest download: {stats['oldest_download']}\")\nprint(f\"Newest download: {stats['newest_download']}\")\n</code></pre>"},{"location":"dl_history_%26_duplicate_prev/#example-5-viewing-history-by-source","title":"Example 5: Viewing History by Source","text":"<pre><code>from tidal_dl_ng.history import HistoryService\n\nhistory = HistoryService()\n\n# Get history grouped by source\nby_source = history.get_history_by_source()\n\nfor source_key, tracks in by_source.items():\n    print(f\"\\n{source_key} ({len(tracks)} tracks):\")\n    for track in tracks:\n        print(f\"  - Track {track['track_id']} - {track['source_name']}\")\n        print(f\"    Downloaded: {track['download_date']}\")\n</code></pre>"},{"location":"dl_history_%26_duplicate_prev/#example-6-gui-toggle-integration","title":"Example 6: GUI Toggle Integration","text":"<pre><code># In GUI code\ndef on_toggle_duplicate_prevention(self, enabled: bool) -&gt; None:\n    \"\"\"User toggled the menu option.\"\"\"\n    # Update setting\n    self.history_service.update_settings(preventDuplicates=enabled)\n\n    # Show feedback\n    status = \"enabled\" if enabled else \"disabled\"\n    self.show_status(f\"Duplicate prevention {status}\")\n\n    # Setting is immediately persisted to JSON\n</code></pre>"},{"location":"dl_history_%26_duplicate_prev/#migration-guide","title":"Migration Guide","text":""},{"location":"dl_history_%26_duplicate_prev/#from-no-history-system","title":"From No History System","text":"<ol> <li>No action needed: The system automatically creates an empty history on first run</li> <li>Existing downloads won't be in history initially</li> <li>New downloads will be tracked going forward</li> </ol>"},{"location":"dl_history_%26_duplicate_prev/#from-legacy-format","title":"From Legacy Format","text":"<p>The system automatically migrates old format files:</p> <p>Old format (tracks at root):</p> <pre><code>{\n  \"_schema_version\": 1,\n  \"123456\": { \"sourceType\": \"...\", ... }\n}\n</code></pre> <p>New format (tracks in section):</p> <pre><code>{\n  \"_schema_version\": 1,\n  \"settings\": { \"preventDuplicates\": true },\n  \"tracks\": {\n    \"123456\": { \"sourceType\": \"...\", ... }\n  }\n}\n</code></pre> <p>Migration happens automatically on load - no user intervention required.</p>"},{"location":"dl_history_%26_duplicate_prev/#performance-considerations","title":"Performance Considerations","text":""},{"location":"dl_history_%26_duplicate_prev/#lookup-performance","title":"Lookup Performance","text":"<ul> <li>Track existence check: O(1) - uses Python dict</li> <li>Should skip check: O(1) - dict lookup + boolean check</li> <li>Memory usage: ~100 bytes per track entry</li> <li>File size: ~150-200 bytes per track in JSON</li> </ul>"},{"location":"dl_history_%26_duplicate_prev/#benchmarks","title":"Benchmarks","text":"Operation Time (avg) Notes Add track &lt;1ms Includes JSON write Check if downloaded &lt;0.1ms Dict lookup only Should skip check &lt;0.1ms Dict lookup + bool Load history (1000 tracks) ~50ms On startup only Save history (1000 tracks) ~100ms Atomic write"},{"location":"dl_history_%26_duplicate_prev/#concurrency","title":"Concurrency","text":"<ul> <li>Thread-safe: All operations use <code>threading.Lock</code></li> <li>No deadlocks: Lock held for minimal time</li> <li>No race conditions: Atomic file writes prevent corruption</li> </ul>"},{"location":"dl_history_%26_duplicate_prev/#troubleshooting","title":"Troubleshooting","text":""},{"location":"dl_history_%26_duplicate_prev/#issue-history-file-corrupted","title":"Issue: History file corrupted","text":"<p>Solution: The system automatically:</p> <ol> <li>Creates a backup <code>.json.bak</code> file</li> <li>Starts with empty history</li> <li>Logs the corruption for investigation</li> </ol>"},{"location":"dl_history_%26_duplicate_prev/#issue-duplicate-prevention-not-working","title":"Issue: Duplicate prevention not working","text":"<p>Check:</p> <ol> <li>Is the setting enabled? <code>history.get_settings()[\"preventDuplicates\"]</code></li> <li>Is the track actually in history? <code>history.is_downloaded(track_id)</code></li> <li>Check logs for skip messages</li> </ol>"},{"location":"dl_history_%26_duplicate_prev/#issue-history-lost-after-crash","title":"Issue: History lost after crash","text":"<p>Note: The system uses atomic writes, so:</p> <ul> <li>Either the old file is intact, OR</li> <li>The new file is complete</li> <li>Never partially written</li> </ul>"},{"location":"dl_history_%26_duplicate_prev/#issue-import-fails","title":"Issue: Import fails","text":"<p>Common causes:</p> <ul> <li>Invalid JSON syntax \u2192 Fix JSON file</li> <li>Missing required fields \u2192 Add <code>sourceType</code>, <code>downloadDate</code></li> <li>Wrong file format \u2192 Use export from same version</li> </ul>"},{"location":"dl_history_%26_duplicate_prev/#future-enhancements","title":"Future Enhancements","text":""},{"location":"dl_history_%26_duplicate_prev/#planned-features","title":"Planned Features","text":"<ul> <li>[ ] Track file paths in history (verify file still exists)</li> <li>[ ] Smart re-download detection (file deleted but in history)</li> <li>[ ] Quality-based history (allow re-download if better quality available)</li> <li>[ ] Batch operations (mark multiple as downloaded/not downloaded)</li> <li>[ ] Search and filter in history dialog</li> <li>[ ] Export to CSV/Excel for analysis</li> <li>[ ] Sync history across devices</li> </ul>"},{"location":"dl_history_%26_duplicate_prev/#api-stability","title":"API Stability","text":"<p>The current API is considered stable and follows semantic versioning:</p> <ul> <li>Patch versions (1.0.x): Bug fixes only</li> <li>Minor versions (1.x.0): New features, backward compatible</li> <li>Major versions (x.0.0): Breaking changes to API or file format</li> </ul>"},{"location":"dl_history_%26_duplicate_prev/#contributing","title":"Contributing","text":""},{"location":"dl_history_%26_duplicate_prev/#code-standards","title":"Code Standards","text":"<p>All code follows the project's AGENTS.md guidelines:</p> <ul> <li>\u2705 Type hints for all functions</li> <li>\u2705 Docstrings (Google style)</li> <li>\u2705 PEP 8 compliance (via Black, Ruff)</li> <li>\u2705 Thread safety where needed</li> <li>\u2705 Comprehensive tests</li> <li>\u2705 Error handling</li> </ul>"},{"location":"dl_history_%26_duplicate_prev/#adding-new-features","title":"Adding New Features","text":"<ol> <li>Update <code>HistoryService</code> class</li> <li>Add tests to <code>test_history_service.py</code></li> <li>Update JSON schema if needed</li> <li>Update this documentation</li> <li>Run all tests: <code>pytest tests/</code></li> <li>Run quality checks: <code>make check</code></li> </ol>"},{"location":"dl_history_%26_duplicate_prev/#license","title":"License","text":"<p>This feature is part of tidal-dl-ng and follows the same license as the main project.</p>"},{"location":"dl_history_%26_duplicate_prev/#changelog","title":"Changelog","text":""},{"location":"dl_history_%26_duplicate_prev/#version-100-2025-11-29","title":"Version 1.0.0 (2025-11-29)","text":"<p>Initial Release</p> <ul> <li>\u2705 Persistent JSON-based download history</li> <li>\u2705 Duplicate prevention with toggle</li> <li>\u2705 Thread-safe operations</li> <li>\u2705 Atomic file writes</li> <li>\u2705 Corruption recovery</li> <li>\u2705 Import/Export functionality</li> <li>\u2705 Statistics and source views</li> <li>\u2705 GUI integration (Tools menu)</li> <li>\u2705 Green console messages for INFO level</li> <li>\u2705 Comprehensive test suite (91 tests)</li> <li>\u2705 Complete documentation</li> </ul>"},{"location":"dl_history_%26_duplicate_prev/#support","title":"Support","text":"<p>For issues, questions, or feature requests:</p> <ol> <li>Check this documentation</li> <li>Review test files for usage examples</li> <li>Open an issue on GitHub with:</li> <li>Description of the problem</li> <li>Steps to reproduce</li> <li>Expected vs actual behavior</li> <li>Log output (if applicable)</li> </ol> <p>Last Updated: 2025-11-29 Version: 1.0.0 Status: Production Ready \u2705</p>"},{"location":"feature_hover_info/","title":"Hover Info Feature","text":""},{"location":"feature_hover_info/#quick-preview-on-hover","title":"Quick Preview on Hover","text":"<p>TIDAL Downloader NG includes a revolutionary hover preview system that displays track metadata instantly when you hover over tracks in the results list.</p>"},{"location":"feature_hover_info/#features","title":"Features","text":"<ul> <li>Instant Display: Track information appears immediately on hover (no clicks required)</li> <li>Tabbed Interface:</li> <li>Details Tab: Shows comprehensive track metadata</li> <li>Cover Art Tab: Displays album artwork</li> <li>Smart Debouncing: 350ms delay prevents UI flickering when moving the mouse</li> <li>Zero Extra API Calls: Uses pre-loaded track data from search results</li> <li>Efficient Caching: Previously viewed tracks display instantly</li> </ul>"},{"location":"feature_hover_info/#displayed-information","title":"Displayed Information","text":""},{"location":"feature_hover_info/#basic-information-instant","title":"Basic Information (Instant)","text":"<ul> <li>Title: Track name</li> <li>Version: Track version/remix info (if available)</li> <li>Artists: Track artists</li> <li>Track #: Track number in album</li> <li>Album: Album name</li> <li>Duration: Track length (mm:ss)</li> <li>Codec: Audio quality (LOSSLESS, AAC, etc.)</li> <li>Bitrate: Audio bitrate (or N/A for variable bitrate)</li> <li>Release Date: Album release date</li> <li>Popularity: Track popularity score</li> <li>ISRC: International Standard Recording Code</li> </ul>"},{"location":"feature_hover_info/#enhanced-information-async","title":"Enhanced Information (Async)","text":"<ul> <li>BPM: Beats per minute \u23f3 (loaded asynchronously from API)</li> <li>Shows <code>\u23f3 Loading...</code> while fetching (~100-500ms)</li> <li>Displays actual BPM value when available</li> <li>Shows <code>\u2014</code> if not available</li> </ul>"},{"location":"feature_hover_info/#cover-art-display","title":"Cover Art Display","text":"<ul> <li>Automatic Loading: Album covers are loaded in the background</li> <li>Smart Caching: Covers are cached for instant display on re-hover</li> <li>Preloading: First 50 tracks in playlists are preloaded for better UX</li> <li>Fallback: Default album image shown if cover is unavailable</li> </ul>"},{"location":"feature_hover_info/#technical-details","title":"Technical Details","text":""},{"location":"feature_hover_info/#architecture","title":"Architecture","text":"<pre><code>User hovers over track\n    \u2193\nHoverManager detects hover (debounced 350ms)\n    \u2193\nInfoTabWidget receives update signal\n    \u2193\n_populate_track_details() displays basic info instantly\n    \u2193\n_request_track_extras_if_needed() triggers async fetch\n    \u2193\nWorker thread fetches BPM from TIDAL API\n    \u2193\nQt Signal invokes callback in main thread\n    \u2193\n_update_extras_ui() updates BPM label\n</code></pre>"},{"location":"feature_hover_info/#performance-optimizations","title":"Performance Optimizations","text":"<ol> <li>LRU Cache: 256-entry cache for track extras</li> <li>Cover Cache: 100-entry cache for album covers</li> <li>Thread-Safe: All background operations are thread-safe</li> <li>Event Filtering: Precise hover detection on tree view viewport</li> <li>Graceful Degradation: Handles missing metadata gracefully</li> </ol>"},{"location":"feature_hover_info/#user-experience","title":"User Experience","text":""},{"location":"feature_hover_info/#on-first-hover","title":"On First Hover","text":"<pre><code>Title:        Fortuna       \u2705 Instant\nArtists:      Asco          \u2705 Instant\nDuration:     03:40         \u2705 Instant\nCodec:        LOSSLESS      \u2705 Instant\nBPM:          \u23f3 Loading... \u23f1\ufe0f Loading indicator (~200ms)\n              \u2193\nBPM:          136           \u2705 Loaded!\n</code></pre>"},{"location":"feature_hover_info/#on-subsequent-hover-same-track","title":"On Subsequent Hover (Same Track)","text":"<pre><code>Title:        Fortuna       \u2705 Instant\nArtists:      Asco          \u2705 Instant\nDuration:     03:40         \u2705 Instant\nBPM:          136           \u2705 Instant (from cache)\n</code></pre>"},{"location":"feature_hover_info/#limitations","title":"Limitations","text":"<p>Due to TIDAL API limitations, the following fields are not applicable in this hover view (they are generally not provided by the public API and thus not displayed):</p> <ul> <li>\u274c Genres</li> <li>\u274c Label</li> <li>\u274c Producers</li> <li>\u274c Composers</li> </ul> <p>See missing_metadata.md for detailed information about API limitations.</p>"},{"location":"feature_hover_info/#code-components","title":"Code Components","text":"<ul> <li><code>InfoTabWidget</code>: Main widget for displaying track information</li> <li><code>HoverManager</code>: Manages hover events on tree view</li> <li><code>CoverManager</code>: Handles cover art loading and caching</li> <li><code>TrackInfoFormatter</code>: Formats track metadata for display</li> <li><code>TrackExtrasCache</code>: LRU cache for async-loaded metadata</li> </ul>"},{"location":"feature_hover_info/#configuration","title":"Configuration","text":"<p>The hover delay is configurable in the code:</p> <pre><code># In hover_manager.py\nself.hover_delay = 350  # milliseconds\n</code></pre> <p>Lower values = more responsive but may flicker Higher values = more stable but less responsive</p>"},{"location":"feature_hover_info/#troubleshooting","title":"Troubleshooting","text":"<p>BPM not displaying?</p> <ul> <li>Check console for API errors</li> <li>Verify track has BPM in TIDAL (not all tracks do)</li> <li>Cache may have stale data (restart application)</li> </ul> <p>Cover not loading?</p> <ul> <li>Check network connection</li> <li>Some tracks may not have cover art</li> <li>Default image will be shown as fallback</li> </ul> <p>Hover not working?</p> <ul> <li>Ensure you're hovering over the results tree view</li> <li>Check that the application has focus</li> <li>Debounce delay may need adjustment</li> </ul>"},{"location":"gui_refactoring/","title":"Architecture GUI Refactor\u00e9e","text":""},{"location":"gui_refactoring/#vue-densemble","title":"Vue d'ensemble","text":"<p>Le fichier <code>gui.py</code> a \u00e9t\u00e9 refactoris\u00e9 pour am\u00e9liorer la maintenabilit\u00e9 en divisant la classe <code>MainWindow</code> monolithique (1837 lignes) en plusieurs modules organis\u00e9s dans le dossier <code>gui/</code>.</p>"},{"location":"gui_refactoring/#structure-des-fichiers","title":"Structure des fichiers","text":"<pre><code>tidal_dl_ng/\n\u251c\u2500\u2500 gui/\n\u2502   \u251c\u2500\u2500 __init__.py              # Point d'entr\u00e9e du module GUI\n\u2502   \u251c\u2500\u2500 activate.py              # Fonction d'activation de l'application GUI\n\u2502   \u251c\u2500\u2500 main_window.py           # Classe MainWindow principale\n\u2502   \u251c\u2500\u2500 initialization.py        # Mixin: Initialisation des composants UI\n\u2502   \u251c\u2500\u2500 tidal_session.py         # Mixin: Gestion de la session Tidal\n\u2502   \u251c\u2500\u2500 signals.py               # Mixin: Gestion des signaux Qt\n\u2502   \u251c\u2500\u2500 progress.py              # Mixin: Barres de progression\n\u2502   \u251c\u2500\u2500 ui_helpers.py            # Mixin: Helpers UI (spinners, logs, statusbar)\n\u2502   \u251c\u2500\u2500 track_extras.py          # Mixin: Cache et gestion des extras de tracks\n\u2502   \u251c\u2500\u2500 updates.py               # Mixin: V\u00e9rification des mises \u00e0 jour\n\u2502   \u251c\u2500\u2500 downloads.py             # Mixin: Gestion des t\u00e9l\u00e9chargements\n\u2502   \u251c\u2500\u2500 trees_results.py         # Mixin: Gestion des arbres et r\u00e9sultats\n\u2502   \u251c\u2500\u2500 context_menus.py         # Mixin: Menus contextuels et actions\n\u2502   \u251c\u2500\u2500 history.py               # Mixin: Historique et pr\u00e9vention des doublons\n\u2502   \u251c\u2500\u2500 covers.py                # Manager de couvertures\n\u2502   \u251c\u2500\u2500 playlist.py              # Manager de playlists\n\u2502   \u251c\u2500\u2500 queue.py                 # Manager de queue\n\u2502   \u2514\u2500\u2500 search.py                # Manager de recherche\n\u251c\u2500\u2500 gui.py                       # Point de compatibilit\u00e9 (redirige vers gui/)\n</code></pre>"},{"location":"gui_refactoring/#mixins-et-responsabilites","title":"Mixins et Responsabilit\u00e9s","text":""},{"location":"gui_refactoring/#1-initializationmixin-initializationpy","title":"1. InitializationMixin (<code>initialization.py</code>)","text":"<p>Responsable de l'initialisation de tous les composants de l'interface utilisateur.</p> <p>M\u00e9thodes:</p> <ul> <li><code>_init_gui()</code> - Configuration de la fen\u00eatre principale</li> <li><code>_init_threads()</code> - Initialisation du pool de threads</li> <li><code>_init_dl()</code> - Configuration de l'objet Download</li> <li><code>_init_progressbar()</code> - Initialisation des barres de progression</li> <li><code>_init_info()</code> - Configuration de l'image de couverture par d\u00e9faut</li> <li><code>_init_tree_results()</code> - Configuration de l'arbre des r\u00e9sultats</li> <li><code>_init_tree_results_model()</code> - Configuration du mod\u00e8le de l'arbre</li> <li><code>_init_tree_queue()</code> - Configuration de la queue de t\u00e9l\u00e9chargement</li> <li><code>_init_tree_lists()</code> - Configuration de l'arbre des listes utilisateur</li> <li><code>_init_menu_actions()</code> - Ajout d'actions de menu personnalis\u00e9es</li> <li><code>_populate_quality()</code> - Remplissage des options de qualit\u00e9</li> <li><code>_populate_search_types()</code> - Remplissage des types de recherche</li> </ul>"},{"location":"gui_refactoring/#2-tidalsessionmixin-tidal_sessionpy","title":"2. TidalSessionMixin (<code>tidal_session.py</code>)","text":"<p>G\u00e8re l'authentification et la session Tidal.</p> <p>M\u00e9thodes:</p> <ul> <li><code>init_tidal()</code> - Initialisation de la session Tidal avec gestion du login</li> <li><code>on_logout()</code> - D\u00e9connexion de Tidal</li> </ul>"},{"location":"gui_refactoring/#3-signalsmixin-signalspy","title":"3. SignalsMixin (<code>signals.py</code>)","text":"<p>Configure toutes les connexions de signaux Qt.</p> <p>M\u00e9thodes:</p> <ul> <li><code>_init_signals()</code> - Connexion de tous les signaux aux slots</li> <li><code>on_result_item_clicked()</code> - Gestion du clic sur un \u00e9l\u00e9ment de r\u00e9sultat</li> <li><code>on_quality_set_audio()</code> - Configuration de la qualit\u00e9 audio</li> <li><code>on_quality_set_video()</code> - Configuration de la qualit\u00e9 vid\u00e9o</li> </ul>"},{"location":"gui_refactoring/#4-progressmixin-progresspy","title":"4. ProgressMixin (<code>progress.py</code>)","text":"<p>G\u00e8re les barres de progression.</p> <p>M\u00e9thodes:</p> <ul> <li><code>on_progress_reset()</code> - R\u00e9initialisation des barres de progression</li> <li><code>on_progress_list()</code> - Mise \u00e0 jour de la barre de progression de liste</li> <li><code>on_progress_item()</code> - Mise \u00e0 jour de la barre de progression d'\u00e9l\u00e9ment</li> <li><code>on_progress_item_name()</code> - D\u00e9finition du nom d'\u00e9l\u00e9ment</li> <li><code>on_progress_list_name()</code> - D\u00e9finition du nom de liste</li> </ul>"},{"location":"gui_refactoring/#5-uihelpersmixin-ui_helperspy","title":"5. UIHelpersMixin (<code>ui_helpers.py</code>)","text":"<p>Fournit des fonctions utilitaires pour l'interface utilisateur.</p> <p>M\u00e9thodes:</p> <ul> <li><code>on_spinner_start()</code> - D\u00e9marrage d'un spinner de chargement</li> <li><code>on_spinner_stop()</code> - Arr\u00eat de tous les spinners</li> <li><code>on_statusbar_message()</code> - Affichage d'un message dans la barre d'\u00e9tat</li> <li><code>_log_output()</code> - Redirection des logs vers l'interface</li> <li><code>button_reload_status()</code> - Mise \u00e0 jour du statut du bouton de rechargement</li> </ul>"},{"location":"gui_refactoring/#6-trackextrasmixin-track_extraspy","title":"6. TrackExtrasMixin (<code>track_extras.py</code>)","text":"<p>G\u00e8re le cache et la r\u00e9cup\u00e9ration des informations suppl\u00e9mentaires des tracks.</p> <p>M\u00e9thodes:</p> <ul> <li><code>get_track_extras()</code> - R\u00e9cup\u00e9ration des extras (avec cache)</li> <li><code>_on_invoke_callback()</code> - Invocation du callback dans le thread principal</li> <li><code>_decorate_extras()</code> - Ajout de champs format\u00e9s aux extras</li> <li><code>preload_covers_for_playlist()</code> - Pr\u00e9chargement des couvertures</li> </ul>"},{"location":"gui_refactoring/#7-updatesmixin-updatespy","title":"7. UpdatesMixin (<code>updates.py</code>)","text":"<p>G\u00e8re la v\u00e9rification des mises \u00e0 jour de l'application.</p> <p>M\u00e9thodes:</p> <ul> <li><code>on_update_check()</code> - V\u00e9rification des mises \u00e0 jour disponibles</li> <li><code>on_version()</code> - Affichage du dialogue de version</li> </ul>"},{"location":"gui_refactoring/#8-downloadsmixin-downloadspy","title":"8. DownloadsMixin (<code>downloads.py</code>)","text":"<p>G\u00e8re la queue de t\u00e9l\u00e9chargement et les op\u00e9rations de t\u00e9l\u00e9chargement.</p> <p>M\u00e9thodes:</p> <ul> <li><code>on_download_results()</code> - T\u00e9l\u00e9chargement des r\u00e9sultats s\u00e9lectionn\u00e9s</li> <li><code>queue_download_media()</code> - Ajout d'un \u00e9l\u00e9ment \u00e0 la queue</li> <li><code>watcher_queue_download()</code> - Surveillance de la queue</li> <li><code>on_queue_download()</code> - Ex\u00e9cution d'un t\u00e9l\u00e9chargement</li> <li><code>download()</code> - T\u00e9l\u00e9chargement d'un \u00e9l\u00e9ment m\u00e9dia</li> <li>M\u00e9thodes de gestion de statut: <code>on_queue_download_item_downloading()</code>, etc.</li> </ul>"},{"location":"gui_refactoring/#9-treesresultsmixin-trees_resultspy","title":"9. TreesResultsMixin (<code>trees_results.py</code>)","text":"<p>G\u00e8re les arbres de vue et l'affichage des r\u00e9sultats.</p> <p>M\u00e9thodes:</p> <ul> <li><code>handle_filter_activated()</code> - Gestion des filtres d'en-t\u00eate</li> <li><code>populate_tree_results()</code> - Remplissage de l'arbre des r\u00e9sultats</li> <li><code>populate_tree_result_child()</code> - Cr\u00e9ation d'un \u00e9l\u00e9ment enfant</li> <li><code>on_tr_results_expanded()</code> - Gestion de l'expansion des r\u00e9sultats</li> <li><code>tr_results_expanded()</code> - Chargement des enfants d'un \u00e9l\u00e9ment</li> <li><code>list_items_show_result()</code> - Affichage des \u00e9l\u00e9ments d'une liste</li> <li><code>tidal_user_lists()</code> - R\u00e9cup\u00e9ration des listes utilisateur</li> <li><code>on_populate_tree_lists()</code> - Remplissage de l'arbre des listes</li> <li><code>on_track_hover_confirmed()</code> - Gestion du survol d'un track</li> <li><code>on_track_hover_left()</code> - Gestion de la sortie du survol</li> </ul>"},{"location":"gui_refactoring/#10-contextmenusmixin-context_menuspy","title":"10. ContextMenusMixin (<code>context_menus.py</code>)","text":"<p>G\u00e8re les menus contextuels et leurs actions.</p> <p>M\u00e9thodes:</p> <ul> <li><code>menu_context_tree_results()</code> - Menu contextuel pour les r\u00e9sultats</li> <li><code>menu_context_queue_download()</code> - Menu contextuel pour la queue</li> <li><code>on_copy_url_share()</code> - Copie de l'URL de partage</li> <li><code>on_download_album_from_track()</code> - T\u00e9l\u00e9chargement de l'album d'un track</li> <li><code>on_download_all_albums_from_playlist()</code> - T\u00e9l\u00e9chargement de tous les albums</li> <li><code>_extract_album_ids_from_tracks()</code> - Extraction des IDs d'albums</li> <li><code>_load_albums_with_rate_limiting()</code> - Chargement avec limitation de d\u00e9bit</li> <li><code>on_search_in_app()</code> - Recherche dans l'application</li> <li><code>on_search_in_browser()</code> - Ouverture de recherche dans le navigateur</li> </ul>"},{"location":"gui_refactoring/#11-historymixin-historypy","title":"11. HistoryMixin (<code>history.py</code>)","text":"<p>G\u00e8re l'historique des t\u00e9l\u00e9chargements et la pr\u00e9vention des doublons.</p> <p>M\u00e9thodes:</p> <ul> <li><code>on_view_history()</code> - Affichage du dialogue d'historique</li> <li><code>on_toggle_duplicate_prevention()</code> - Activation/d\u00e9sactivation de la pr\u00e9vention</li> <li><code>on_mark_track_as_downloaded()</code> - Marquer un track comme t\u00e9l\u00e9charg\u00e9</li> <li><code>on_mark_track_as_not_downloaded()</code> - Retirer le marquage</li> <li><code>_update_downloaded_column()</code> - Mise \u00e0 jour de la colonne UI</li> <li><code>on_preferences()</code> - Ouverture du dialogue de pr\u00e9f\u00e9rences</li> <li><code>on_settings_save()</code> - Sauvegarde des param\u00e8tres</li> </ul>"},{"location":"gui_refactoring/#classe-mainwindow","title":"Classe MainWindow","text":"<p>La classe <code>MainWindow</code> h\u00e9rite de tous les mixins et de <code>QtWidgets.QMainWindow</code> + <code>Ui_MainWindow</code>:</p> <pre><code>class MainWindow(\n    QtWidgets.QMainWindow,\n    Ui_MainWindow,\n    InitializationMixin,\n    TidalSessionMixin,\n    SignalsMixin,\n    ProgressMixin,\n    UIHelpersMixin,\n    TrackExtrasMixin,\n    UpdatesMixin,\n    DownloadsMixin,\n    TreesResultsMixin,\n    ContextMenusMixin,\n    HistoryMixin,\n):\n    ...\n</code></pre>"},{"location":"gui_refactoring/#compatibilite","title":"Compatibilit\u00e9","text":"<p>Le fichier <code>gui.py</code> original est maintenu comme point de compatibilit\u00e9 :</p> <ul> <li>Redirige les imports vers <code>tidal_dl_ng.gui</code></li> <li>Conserve les directives de compilation nuitka</li> <li>Permet une migration progressive</li> </ul>"},{"location":"gui_refactoring/#avantages-de-cette-architecture","title":"Avantages de cette architecture","text":"<ol> <li>Maintenabilit\u00e9 : Chaque mixin a une responsabilit\u00e9 claire et limit\u00e9e</li> <li>Lisibilit\u00e9 : Fichiers plus petits et focalis\u00e9s (100-300 lignes vs 1837)</li> <li>Testabilit\u00e9 : Les mixins peuvent \u00eatre test\u00e9s individuellement</li> <li>Extensibilit\u00e9 : Facile d'ajouter de nouvelles fonctionnalit\u00e9s</li> <li>R\u00e9utilisabilit\u00e9 : Les mixins peuvent \u00eatre r\u00e9utilis\u00e9s si n\u00e9cessaire</li> <li>Organisation : Structure logique par fonctionnalit\u00e9</li> </ol>"},{"location":"gui_refactoring/#migration","title":"Migration","text":"<p>Pour utiliser la nouvelle structure :</p> <pre><code># Ancienne m\u00e9thode (toujours support\u00e9e)\nfrom tidal_dl_ng.gui import gui_activate\n\n# Nouvelle m\u00e9thode recommand\u00e9e\nfrom tidal_dl_ng.gui import MainWindow\nfrom tidal_dl_ng.gui.activate import gui_activate\n</code></pre>"},{"location":"gui_refactoring/#notes","title":"Notes","text":"<ul> <li>Les avertissements IDE sur les \"unresolved attributes\" dans les mixins sont normaux</li> <li>Les mixins acc\u00e8dent \u00e0 <code>self</code> qui sera fourni par <code>MainWindow</code> via l'h\u00e9ritage multiple</li> <li>L'ordre des mixins dans l'h\u00e9ritage est important pour la r\u00e9solution de m\u00e9thode (MRO)</li> </ul>"},{"location":"missing_metadata/","title":"Missing Metadata in the Interface","text":""},{"location":"missing_metadata/#why-do-some-fields-display-or-na","title":"Why do some fields display \"\u2014\" or \"N/A\"?","text":"<p>When using TIDAL Downloader NG, some metadata fields may display <code>\u2014</code> (dash) or <code>N/A</code>. This means that the data is not provided by the TIDAL API for that specific track/album.</p>"},{"location":"missing_metadata/#affected-fields","title":"Affected Fields","text":"<p>The following fields depend on data availability from the TIDAL API:</p> Field API Source Notes Status BPM Track JSON (<code>bpm</code>) Loaded asynchronously from API \u2705 Functional Bitrate Calculated based on codec <code>N/A</code> for LOSSLESS (variable bitrate) \u2705 Functional Codec Track metadata Always available (LOSSLESS, AAC, etc.) \u2705 Functional Genres Album JSON (<code>genres</code> or <code>genre</code>) Not available via TIDAL API v2 \u274c Removed from interface Label Album JSON (<code>label</code> or <code>recordLabel</code>) Not reliably available \u274c Removed from interface Producers Track/Album JSON (<code>credits</code> or <code>contributors</code> with role=\"producer\") Not available via TIDAL API v2 \u274c Removed from interface Composers Track/Album JSON (<code>credits</code> or <code>contributors</code> with role=\"composer\") Not available via TIDAL API v2 \u274c Removed from interface"},{"location":"missing_metadata/#recent-improvements-api-limitations","title":"Recent Improvements &amp; API Limitations","text":"<p>Current version: The application retrieves available metadata from the TIDAL API:</p> <ul> <li>\u2705 BPM: Loaded asynchronously from <code>track._data['bpm']</code> via API</li> <li>\u2705 Display of basic information: title, artists, album, duration, codec, bitrate</li> <li>\u2705 ISRC, track number, release date, popularity</li> <li>\u274c Genres, Label, Producers, Composers: Removed from interface (not available via API)</li> </ul> <p>TIDAL API Limitations:</p> <p>According to the official TIDAL OpenAPI specification analysis (https://tidal-music.github.io/tidal-api-reference/):</p> <ul> <li>\u274c No reliable <code>genres</code> field in API v2 (sometimes present but often empty)</li> <li>\u274c No <code>credits</code> field in API v2</li> <li>\u274c No <code>contributors</code> field in API v2</li> <li>\u274c No <code>producers</code> field available</li> <li>\u274c No <code>composers</code> field available</li> <li>\u274c <code>label</code> and <code>recordLabel</code> only available at album level, and often absent</li> </ul> <p>The TIDAL API v2 (official JSON:API) does NOT reliably provide these metadata. The older API v1 (undocumented) may contain some of these fields randomly, but they are not guaranteed and depend entirely on what music labels provide to TIDAL.</p>"},{"location":"missing_metadata/#what-is-actually-available","title":"What is Actually Available","text":"<p>Fields guaranteed by the TIDAL API:</p> <ul> <li>\u2705 <code>title</code>, <code>duration</code>, <code>isrc</code>, <code>explicit</code></li> <li>\u2705 <code>bpm</code> (optional, when provided by the label)</li> <li>\u2705 <code>popularity</code> (0.0 - 1.0)</li> <li>\u2705 <code>mediaTags</code> (HIRES_LOSSLESS, etc.)</li> <li>\u2705 <code>artists</code> via relationship</li> <li>\u2705 <code>album</code> via relationship</li> <li>\u2705 <code>genres</code> via relationship (but often empty)</li> </ul>"},{"location":"missing_metadata/#why-is-this-data-missing","title":"Why is this Data Missing?","text":"<ol> <li>TIDAL doesn't have the information: Some metadata is not provided by music labels</li> <li>Data not exposed by API: Even if TIDAL displays certain information on their website, the public API may not provide it</li> <li>Variability by track: An album may have genres, but individual tracks may not</li> <li>Metadata quality: Some independent or older tracks may have incomplete metadata</li> </ol>"},{"location":"missing_metadata/#api-response-example","title":"API Response Example","text":"<p>For the track \"Breathing (Techno)\" in your screenshot:</p> <pre><code>Track ID: 336084531\n- BPM: Not provided by TIDAL\n- Label: Not provided by TIDAL\n- Genres: Not provided by TIDAL\n- Contributors: Maybe available but without specific role (producer/composer)\n</code></pre>"},{"location":"missing_metadata/#how-to-get-more-data","title":"How to Get More Data?","text":"<ol> <li>Check TIDAL directly: Sometimes data is visible on the TIDAL website but not via API</li> <li>Use other sources: MusicBrainz, Discogs, etc. (not integrated in tidal-dl-ng)</li> <li>Manual editing: After download, use a tag editor (Mp3tag, Kid3, etc.)</li> </ol>"},{"location":"missing_metadata/#debugging","title":"Debugging","text":"<p>To see what the TIDAL API returns, you can check the console output when hovering over tracks. The application silently fetches BPM data in the background without cluttering the console.</p> <p>Technical Architecture: BPM is loaded asynchronously:</p> <ol> <li>Worker thread fetches raw JSON data from TIDAL API</li> <li><code>parse_track_and_album_extras()</code> extracts BPM from JSON</li> <li>Qt Signal (<code>s_invoke_callback</code>) emits result to main thread</li> <li>Stored callback is invoked in main thread (safe for UI updates)</li> <li><code>_handle_track_extras_ready</code> verifies it's the correct track</li> <li><code>_update_extras_ui</code> updates the BPM label in the interface</li> </ol> <p>Loading Indicator: While BPM is being fetched, you'll see:</p> <ul> <li><code>\u23f3 Loading...</code> - BPM data is being fetched from API (~100-500ms)</li> <li><code>136</code> - BPM value successfully loaded</li> <li><code>\u2014</code> - BPM not available for this track</li> </ul> <p>Note: If you previously hovered over a track, the BPM will display instantly on subsequent hovers thanks to the built-in cache system.</p>"},{"location":"missing_metadata/#bitrate-na-for-lossless","title":"Bitrate = N/A for LOSSLESS","text":"<p>The LOSSLESS codec (FLAC) uses lossless compression with a variable bitrate (VBR). The exact bitrate depends on the audio content and changes constantly during playback. This is why it is displayed as <code>N/A</code> rather than a fixed number.</p> <p>For codecs with fixed bitrate (AAC, etc.), you will see a number like \"320 kbps\".</p>"},{"location":"modules/","title":"Modules","text":""},{"location":"playlist_api_architecture/","title":"Architecture des appels API pour les playlists","text":""},{"location":"playlist_api_architecture/#vue-densemble","title":"Vue d'ensemble","text":"<p>Tous les appels API li\u00e9s aux playlists ont \u00e9t\u00e9 centralis\u00e9s dans un seul module pour une meilleure maintenabilit\u00e9 et coh\u00e9rence.</p>"},{"location":"playlist_api_architecture/#fichier-centralise-tidal_dl_nghelperplaylist_apipy","title":"Fichier centralis\u00e9 : <code>tidal_dl_ng/helper/playlist_api.py</code>","text":"<p>Ce module contient toutes les fonctions d'interaction avec l'API Tidal pour les playlists :</p>"},{"location":"playlist_api_architecture/#fonctions-disponibles","title":"Fonctions disponibles","text":""},{"location":"playlist_api_architecture/#1-get_user_playlistssession-session-listuserplaylist","title":"1. <code>get_user_playlists(session: Session) -&gt; list[UserPlaylist]</code>","text":"<ul> <li>Description: R\u00e9cup\u00e8re toutes les playlists de l'utilisateur</li> <li>Param\u00e8tres: Session Tidal authentifi\u00e9e</li> <li>Retour: Liste d'objets UserPlaylist</li> <li>Exceptions: RequestException, ValueError</li> </ul>"},{"location":"playlist_api_architecture/#2-get_playlist_itemsplaylist-userplaylist-listtrack","title":"2. <code>get_playlist_items(playlist: UserPlaylist) -&gt; list[Track]</code>","text":"<ul> <li>Description: R\u00e9cup\u00e8re tous les morceaux d'une playlist</li> <li>Param\u00e8tres: Objet UserPlaylist</li> <li>Retour: Liste d'objets Track</li> <li>Exceptions: RequestException</li> </ul>"},{"location":"playlist_api_architecture/#3-add_track_to_playlistsession-session-playlist_id-str-track_id-str-none","title":"3. <code>add_track_to_playlist(session: Session, playlist_id: str, track_id: str) -&gt; None</code>","text":"<ul> <li>Description: Ajoute un morceau \u00e0 une playlist</li> <li>Param\u00e8tres:</li> <li>session: Session Tidal</li> <li>playlist_id: UUID de la playlist</li> <li>track_id: UUID du morceau</li> <li>Exceptions: RequestException, ValueError</li> </ul>"},{"location":"playlist_api_architecture/#4-remove_track_from_playlistsession-session-playlist_id-str-track_id-str-none","title":"4. <code>remove_track_from_playlist(session: Session, playlist_id: str, track_id: str) -&gt; None</code>","text":"<ul> <li>Description: Retire un morceau d'une playlist</li> <li>Param\u00e8tres:</li> <li>session: Session Tidal</li> <li>playlist_id: UUID de la playlist</li> <li>track_id: UUID du morceau</li> <li>Exceptions: RequestException, ValueError</li> <li>Note: G\u00e8re automatiquement la recherche de l'index du morceau</li> </ul>"},{"location":"playlist_api_architecture/#5-get_playlist_metadataplaylist-userplaylist-dictstr-str-int","title":"5. <code>get_playlist_metadata(playlist: UserPlaylist) -&gt; dict[str, str | int]</code>","text":"<ul> <li>Description: Extrait les m\u00e9tadonn\u00e9es d'une playlist</li> <li>Param\u00e8tres: Objet UserPlaylist</li> <li>Retour: Dictionnaire avec <code>name</code>, <code>item_count</code>, <code>id</code></li> </ul>"},{"location":"playlist_api_architecture/#modules-utilisant-lapi-centralisee","title":"Modules utilisant l'API centralis\u00e9e","text":""},{"location":"playlist_api_architecture/#1-tidal_dl_ngguidialog_playlist_managerpy","title":"1. <code>tidal_dl_ng/gui/dialog_playlist_manager.py</code>","text":"<p>Utilise : - <code>add_track_to_playlist()</code> - Pour ajouter des morceaux via l'interface - <code>remove_track_from_playlist()</code> - Pour retirer des morceaux via l'interface</p>"},{"location":"playlist_api_architecture/#2-tidal_dl_ngguiplaylist_membershippy","title":"2. <code>tidal_dl_ng/gui/playlist_membership.py</code>","text":"<p>Utilise : - <code>get_user_playlists()</code> - Pour charger les playlists au d\u00e9marrage - <code>get_playlist_items()</code> - Pour construire le cache de memberships - <code>get_playlist_metadata()</code> - Pour afficher les noms et comptes</p>"},{"location":"playlist_api_architecture/#avantages-de-cette-architecture","title":"Avantages de cette architecture","text":"<ol> <li>Maintenabilit\u00e9 : Un seul endroit pour modifier la logique API</li> <li>Coh\u00e9rence : M\u00eame gestion d'erreurs partout</li> <li>Testabilit\u00e9 : Facile de mocker les fonctions API</li> <li>Logging centralis\u00e9 : Tous les logs API au m\u00eame endroit</li> <li>\u00c9volutivit\u00e9 : Facile d'ajouter de nouvelles fonctions</li> </ol>"},{"location":"playlist_api_architecture/#gestion-des-erreurs","title":"Gestion des erreurs","text":"<p>Toutes les fonctions : - Loggent les erreurs avec <code>logger_gui</code> - Propagent les exceptions (RequestException) pour que l'appelant puisse g\u00e9rer - G\u00e8rent automatiquement les cas limites (playlist vide, morceau non trouv\u00e9, etc.)</p>"},{"location":"playlist_api_architecture/#exemple-dutilisation","title":"Exemple d'utilisation","text":"<pre><code>from tidal_dl_ng.helper.playlist_api import add_track_to_playlist, get_user_playlists\n\n# R\u00e9cup\u00e9rer les playlists\nplaylists = get_user_playlists(session)\n\n# Ajouter un morceau\ntry:\n    add_track_to_playlist(session, playlist_id=\"abc123\", track_id=\"def456\")\n    print(\"Morceau ajout\u00e9 avec succ\u00e8s\")\nexcept RequestException as e:\n    print(f\"Erreur: {e}\")\n</code></pre>"},{"location":"playlist_api_architecture/#migration-future","title":"Migration future","text":"<p>Si besoin de passer \u00e0 une autre biblioth\u00e8que API ou d'ajouter un cache HTTP, il suffit de modifier <code>playlist_api.py</code> sans toucher aux autres fichiers.</p>"},{"location":"playlist_membership_manager/","title":"Gestionnaire d'Appartenance aux Playlists (Playlist Membership Manager)","text":""},{"location":"playlist_membership_manager/#vue-densemble-architecturale","title":"Vue d'ensemble architecturale","text":""},{"location":"playlist_membership_manager/#probleme-utilisateur","title":"Probl\u00e8me utilisateur","text":"<p>L'application agit actuellement comme un silo de t\u00e9l\u00e9chargement. Pour organiser sa musique (ajouter \u00e0 une playlist), l'utilisateur doit quitter l'app, ouvrir le client officiel Tidal, chercher \u00e0 nouveau, puis agir. Ceci rompt le flux d'exp\u00e9rience.</p>"},{"location":"playlist_membership_manager/#solution-proposee","title":"Solution propos\u00e9e","text":"<p>Transformer chaque vue de r\u00e9sultats (Album, Recherche, Playlist) en tableau interactif avec : - Une colonne d\u00e9di\u00e9e \"Playlists\" - Indicateur visuel instantan\u00e9 de l'appartenance - Gestion d'ajout/retrait sans friction</p>"},{"location":"playlist_membership_manager/#1-strategie-de-pre-chargement-eager-loading-caching","title":"1. Strat\u00e9gie de Pr\u00e9-chargement (Eager Loading &amp; Caching)","text":""},{"location":"playlist_membership_manager/#11-objectif-de-performance","title":"1.1 Objectif de performance","text":"<p>\u00c9liminer toute latence au clic. L'utilisateur accepte d'attendre le spinner au rechargement de la vue, mais pas l'ouverture du dialogue.</p>"},{"location":"playlist_membership_manager/#12-architecture-du-worker","title":"1.2 Architecture du Worker","text":"<pre><code>Event: modelReset / layoutChanged (Main Table)\n    \u2193\nD\u00e9clenche PlaylistContextLoader (QRunnable)\n    \u2193\nThread Pool Execution:\n    \u251c\u2500 Fetch User Playlists (GET /users/{userId}/playlists)\n    \u2502  \u2514\u2500 Pagination g\u00e9r\u00e9e (limit=50 par d\u00e9faut)\n    \u2502  \u2514\u2500 Filtre des playlists \u00e9ditables\n    \u251c\u2500 Parall\u00e8le : Fetch Playlist Contents\n    \u2502  \u251c\u2500 Pour chaque playlist : GET /playlists/{id}/items?offset=0&amp;limit=300\n    \u2502  \u2514\u2500 Accumule les Track IDs dans Set pour O(1) lookup\n    \u2514\u2500 Spinlock/Event synchronisation\n         \u2193\n    Construit: Cache = Dict[TrackID, Set[PlaylistID]]\n         \u2193\n    \u00c9met Signal: playlistCacheReady(cache_dict)\n         \u2193\n    Tableau met \u00e0 jour Delegate \u2192 Spinner OFF, Bouton ON\n</code></pre>"},{"location":"playlist_membership_manager/#13-structure-de-donnees","title":"1.3 Structure de donn\u00e9es","text":"<pre><code># Cache structure\nPlaylistCache = Dict[str, Set[str]]\n# Exemple:\n# {\n#   \"track_uuid_1\": {\"playlist_id_1\", \"playlist_id_2\"},\n#   \"track_uuid_2\": {\"playlist_id_3\"},\n# }\n\n# Thread-safe wrapper\nclass ThreadSafePlaylistCache:\n    _lock: threading.RLock\n    _data: Dict[str, Set[str]]\n    _metadata: Dict[str, PlaylistMetadata]\n\n    def get(self, track_id: str) -&gt; Set[str]:\n        \"\"\"O(1) lookup with thread safety\"\"\"\n\n    def update_track(self, track_id: str, playlist_ids: Set[str]):\n        \"\"\"Atomic update\"\"\"\n</code></pre>"},{"location":"playlist_membership_manager/#14-gestion-derreurs-et-interruption","title":"1.4 Gestion d'erreurs et interruption","text":"<ul> <li>Interruptibilit\u00e9 : Signal <code>abort_requested</code> pendant le chargement</li> <li>Fail-silent : Les erreurs r\u00e9seau n'affichent pas de popup</li> <li>Timeout : Limite de 30s par playlistId</li> <li>Limite de taux : Max 5 requ\u00eates parall\u00e8les (QThreadPool.maxThreadCount() = 5)</li> </ul>"},{"location":"playlist_membership_manager/#2-interface-colonne-playlists-delegate-etats","title":"2. Interface - Colonne \"Playlists\" (Delegate &amp; \u00c9tats)","text":""},{"location":"playlist_membership_manager/#21-machine-a-etats-visuels","title":"2.1 Machine \u00e0 \u00e9tats visuels","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 \u00c9tat 1: PENDING (Initial)                               \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 Trigger: Cache not ready for this track                 \u2502\n\u2502 Visual: Spinner anim\u00e9 (SVG/QMovie), d\u00e9sactiv\u00e9           \u2502\n\u2502 Interaction: D\u00e9sactiv\u00e9e (curseur \"wait\")                \u2502\n\u2502 Dur\u00e9e: 0-5 secondes max                                 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                            \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 \u00c9tat 2: READY (Normal)                                  \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 Trigger: Cache ready pour ce track                      \u2502\n\u2502 Visual: Flat Button \"\ud83d\udccb Playlists\", gris neutre        \u2502\n\u2502 Interaction: Cliquable (curseur \"pointer\")              \u2502\n\u2502 Action: Ouvre PlaylistManagerDialog                     \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                    \u2199 (erreur lors du clic)\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 \u00c9tat 3: ERROR (Optionnel)                               \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 Trigger: Pr\u00e9chargement \u00e9chou\u00e9 (API down)                \u2502\n\u2502 Visual: Ic\u00f4ne d'avertissement \u26a0\ufe0f grise                   \u2502\n\u2502 Interaction: D\u00e9sactiv\u00e9e avec tooltip                    \u2502\n\u2502 Dur\u00e9e: Persistant jusqu'\u00e0 reload                        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"playlist_membership_manager/#22-integration-qstyleditemdelegate","title":"2.2 Int\u00e9gration QStyledItemDelegate","text":"<pre><code>QTableView/QTreeView ModelReset\n    \u2193\nplaylistColumnDelegate.setModelData()\n    \u251c\u2500 row = model_index.row()\n    \u251c\u2500 track_id = model.data(row, TrackIdRole)\n    \u251c\u2500 state = cache.get_state(track_id) \u2192 [PENDING|READY|ERROR]\n    \u2514\u2500 paint() selon state\n        \u251c\u2500 PENDING: drawSpinner()\n        \u251c\u2500 READY: drawButton()\n        \u2514\u2500 ERROR: drawWarningIcon()\n</code></pre>"},{"location":"playlist_membership_manager/#3-fenetre-modale-playlistmanagerdialog","title":"3. Fen\u00eatre Modale : PlaylistManagerDialog","text":""},{"location":"playlist_membership_manager/#31-design-layout","title":"3.1 Design &amp; Layout","text":"<pre><code>\u2554\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2557\n\u2551 G\u00e9rer les playlists pour: [TRACK_TITLE]                   \u2551 \u2190 QLabel\n\u2560\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2563\n\u2551                                                            \u2551\n\u2551  \u2610 Favorites                                       (16)    \u2551 \u2190 QCheckBox + QLabel\n\u2551  \u2610 Night Vibes                                     (42)    \u2551\n\u2551  \u2610 Workout Mix                                     (103)   \u2551\n\u2551  \u2610 D\u00e9couvertes semaine                             (27)    \u2551\n\u2551                                                            \u2551\n\u2551  [Scroll Area: QScrollArea]                              \u2551\n\u2551                                                            \u2551\n\u2560\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2563\n\u2551                                       [Fermer]             \u2551 \u2190 QPushButton\n\u255a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u255d\n</code></pre>"},{"location":"playlist_membership_manager/#32-composants","title":"3.2 Composants","text":"<pre><code>class PlaylistManagerDialog(QDialog):\n    \"\"\"Dialogue de gestion des appartenance aux playlists.\"\"\"\n\n    # Signals\n    playlist_added: QtCore.Signal = QtCore.Signal(str, str)  # track_id, playlist_id\n    playlist_removed: QtCore.Signal = QtCore.Signal(str, str)\n\n    def __init__(self,\n                 track: Track,\n                 cache: ThreadSafePlaylistCache,\n                 tidal_session: Session,\n                 parent: QWidget):\n        \"\"\"Initialisation du dialogue.\n\n        Args:\n            track: La piste courante\n            cache: Le cache pr\u00e9-charg\u00e9\n            tidal_session: Session Tidal pour les appels API\n            parent: Widget parent\n        \"\"\"\n\n    def populate_playlists(self) -&gt; None:\n        \"\"\"Remplit la liste des playlists depuis le cache.\n\n        - Tri alphab\u00e9tique\n        - R\u00e9cup\u00e8re l'\u00e9tat d'appartenance du cache\n        - Cr\u00e9e les checkboxes\n        \"\"\"\n\n    def on_playlist_toggled(self, checkbox: QCheckBox,\n                           playlist_id: str,\n                           is_checked: bool) -&gt; None:\n        \"\"\"G\u00e8re le changement d'\u00e9tat d'une checkbox.\n\n        Flux:\n        1. D\u00e9sactiver checkbox + afficher spinner\n        2. Appel API (POST/DELETE)\n        3. Succ\u00e8s: Mettre \u00e0 jour cache local\n        4. Erreur: Rollback + Toast notification\n        \"\"\"\n</code></pre>"},{"location":"playlist_membership_manager/#33-logique-transactionnelle","title":"3.3 Logique transactionnelle","text":"<pre><code>User clicks checkbox\n    \u2193\non_playlist_toggled(playlist_id, is_checked)\n    \u251c\u2500 Sauvegarder l'\u00e9tat pr\u00e9c\u00e9dent (rollback_state)\n    \u251c\u2500 D\u00e9sactiver checkbox visuellement\n    \u251c\u2500 Afficher mini-spinner\n    \u251c\u2500 D\u00e9terminer l'action: ADD (POST) ou REMOVE (DELETE)\n    \u251c\u2500 Appel API thread\u00e9\n    \u2502   \u251c\u2500 Succ\u00e8s (200 OK):\n    \u2502   \u2502   \u251c\u2500 Mettre \u00e0 jour cache[track_id][playlist_id]\n    \u2502   \u2502   \u251c\u2500 R\u00e9activer checkbox\n    \u2502   \u2502   \u2514\u2500 \u00c9mettre signal (pour synchronisation UI)\n    \u2502   \u2502\n    \u2502   \u2514\u2500 \u00c9chec (4xx/5xx):\n    \u2502       \u251c\u2500 Restorer checkbox \u00e9tat = rollback_state\n    \u2502       \u251c\u2500 R\u00e9activer checkbox\n    \u2502       \u2514\u2500 Afficher Toast: \"Impossible de modifier\"\n    \u2502\n    \u2514\u2500 [FIN]\n</code></pre>"},{"location":"playlist_membership_manager/#4-implementation-api-services","title":"4. Impl\u00e9mentation API &amp; Services","text":""},{"location":"playlist_membership_manager/#41-playlistcontextloader-worker-thread","title":"4.1 PlaylistContextLoader (Worker Thread)","text":"<pre><code>class PlaylistContextLoader(QtCore.QRunnable):\n    \"\"\"Charge les contextes de playlists de mani\u00e8re concurrente.\"\"\"\n\n    # Signals (communiquent du worker thread \u2192 main thread)\n    started: QtCore.Signal = QtCore.Signal()\n    progress: QtCore.Signal = QtCore.Signal(int, int)  # current, total\n    cache_ready: QtCore.Signal = QtCore.Signal(dict)  # ThreadSafePlaylistCache\n    error: QtCore.Signal = QtCore.Signal(str)\n    finished: QtCore.Signal = QtCore.Signal()\n\n    def __init__(self,\n                 session: Session,\n                 user_id: str,\n                 max_workers: int = 5):\n        \"\"\"Initialise le loader.\n\n        Args:\n            session: Session Tidal authentifi\u00e9e\n            user_id: ID de l'utilisateur courant\n            max_workers: Nombre de threads concurrents pour les requ\u00eates\n        \"\"\"\n\n    def run(self) -&gt; None:\n        \"\"\"Point d'entr\u00e9e du thread worker.\n\n        S\u00e9quence:\n        1. Fetch all user playlists (pagination)\n        2. Pour chaque playlist (parall\u00e8le):\n           - Fetch all items (pagination)\n           - Extract track IDs\n        3. Build cache Dict[track_id, Set[playlist_id]]\n        4. \u00c9mettre signal cache_ready avec cache\n        \"\"\"\n\n    def _fetch_user_playlists(self) -&gt; list[Playlist]:\n        \"\"\"R\u00e9cup\u00e8re toutes les playlists de l'utilisateur.\n\n        G\u00e8re la pagination (offset/limit).\n        Filtre les playlists \u00e9ditables uniquement.\n        \"\"\"\n\n    def _fetch_playlist_items(self,\n                             playlist_id: str,\n                             limit: int = 300) -&gt; set[str]:\n        \"\"\"R\u00e9cup\u00e8re tous les IDs de pistes d'une playlist.\n\n        G\u00e8re la pagination automatique.\n        Retourne un Set pour O(1) lookup.\n        \"\"\"\n\n    def request_abort(self) -&gt; None:\n        \"\"\"Demande l'interruption du loader.\n\n        Interruptibilit\u00e9: Finit la requ\u00eate en cours, puis s'arr\u00eate.\n        \"\"\"\n</code></pre>"},{"location":"playlist_membership_manager/#42-endpoints-tidal-utilises","title":"4.2 Endpoints Tidal utilis\u00e9s","text":"<pre><code># 1. R\u00e9cup\u00e9rer les playlists\nGET /users/{userId}/playlists\n    ?offset=0\n    &amp;limit=50\n    &amp;includeOnly=EDITORIAL,COLLABORATIVE\n\nResponse: {\"items\": [...], \"totalNumberOfItems\": N}\n\n# 2. R\u00e9cup\u00e9rer les items d'une playlist\nGET /playlists/{playlistId}/items\n    ?offset=0\n    &amp;limit=300\n    &amp;includeOnly=TRACKS,VIDEOS\n\nResponse: {\"items\": [...], \"totalNumberOfItems\": M}\n           o\u00f9 items[i].item.id = track_uuid\n\n# 3. Ajouter une piste \u00e0 une playlist\nPOST /playlists/{playlistId}/items\n    Content-Type: application/json\n    {\"trackIds\": [\"uuid1\", \"uuid2\"]}\n\n# 4. Supprimer une piste d'une playlist\nDELETE /playlists/{playlistId}/items/{itemId}\n       OU\nDELETE /playlists/{playlistId}/items?itemIds=uuid1,uuid2\n</code></pre>"},{"location":"playlist_membership_manager/#43-rate-limiting-timeout","title":"4.3 Rate Limiting &amp; Timeout","text":"<ul> <li>Timeout par requ\u00eate : 30 secondes</li> <li>Max concurrent requests : 5 (limit\u00e9 par QThreadPool)</li> <li>Backoff strategy : Exponentiel (1s \u2192 2s \u2192 4s) sur 429/503</li> <li>Fail-silent : Log warning, pas de popup utilisateur</li> </ul>"},{"location":"playlist_membership_manager/#5-integration-dans-mainwindow","title":"5. Int\u00e9gration dans MainWindow","text":""},{"location":"playlist_membership_manager/#51-initialization-flow","title":"5.1 Initialization Flow","text":"<pre><code>class MainWindow:\n    def init_playlist_membership_manager(self):\n        \"\"\"Initialise le gestionnaire d'appartenance aux playlists.\"\"\"\n\n        # 1. Cr\u00e9er le cache thread-safe\n        self.playlist_cache = ThreadSafePlaylistCache()\n\n        # 2. Cr\u00e9er le worker (pas de d\u00e9marrage encore)\n        self.playlist_loader = PlaylistContextLoader(\n            session=self.tidal.session,\n            user_id=self.tidal.user_id,\n            max_workers=5\n        )\n\n        # 3. Connecter les signaux du worker\n        self.playlist_loader.cache_ready.connect(self.on_playlist_cache_ready)\n        self.playlist_loader.error.connect(self.on_playlist_loader_error)\n        self.playlist_loader.progress.connect(self.on_playlist_loader_progress)\n\n        # 4. Connecter les signaux du tableau\n        self.model_tr_results.modelReset.connect(self.on_results_layout_changed)\n        self.proxy_tr_results.layoutChanged.connect(self.on_results_layout_changed)\n\n        # 5. Ajouter le delegate personnalis\u00e9\n        self.playlist_column_delegate = PlaylistColumnDelegate(\n            parent=self.tr_results\n        )\n        self.tr_results.setItemDelegateForColumn(PLAYLIST_COLUMN_INDEX,\n                                               self.playlist_column_delegate)\n\n    def on_results_layout_changed(self) -&gt; None:\n        \"\"\"D\u00e9clenche le pr\u00e9-chargement lors d'un changement de r\u00e9sultats.\"\"\"\n\n        # 1. R\u00e9initialiser le cache\n        self.playlist_cache.clear()\n\n        # 2. Lancer le worker de pr\u00e9-chargement\n        self.threadpool.start(self.playlist_loader)\n\n    def on_playlist_cache_ready(self, cache: dict) -&gt; None:\n        \"\"\"Appel\u00e9 quand le cache est pr\u00eat.\n\n        Notifie le delegate que le cache a chang\u00e9.\n        \"\"\"\n        self.playlist_cache.update_from_dict(cache)\n        self.playlist_column_delegate.setCacheReady(True)\n        self.tr_results.viewport().update()  # Redessine les cellules\n</code></pre>"},{"location":"playlist_membership_manager/#6-tests-qualite","title":"6. Tests &amp; Qualit\u00e9","text":""},{"location":"playlist_membership_manager/#61-fichier-de-tests-teststest_playlist_managerpy","title":"6.1 Fichier de tests: tests/test_playlist_manager.py","text":"<pre><code>class TestPlaylistContextLoader(unittest.TestCase):\n    \"\"\"Tests du worker de pr\u00e9-chargement.\"\"\"\n\n    def test_fetch_user_playlists_pagination(self):\n        \"\"\"V\u00e9rifie la gestion de la pagination.\"\"\"\n\n    def test_build_cache_structure(self):\n        \"\"\"V\u00e9rifie la construction correcte du cache.\"\"\"\n\n    def test_thread_safety_concurrent_updates(self):\n        \"\"\"V\u00e9rifie la thread-safety lors d'acc\u00e8s concurrents.\"\"\"\n\n    def test_abort_request(self):\n        \"\"\"V\u00e9rifie l'interruption du worker.\"\"\"\n\n    def test_error_handling_api_failure(self):\n        \"\"\"V\u00e9rifie la gestion des erreurs API.\"\"\"\n\n\nclass TestPlaylistManagerDialog(unittest.TestCase):\n    \"\"\"Tests du dialogue modal.\"\"\"\n\n    def test_dialog_initialization(self):\n        \"\"\"V\u00e9rifie l'initialisation correcte du dialogue.\"\"\"\n\n    def test_checkbox_state_from_cache(self):\n        \"\"\"V\u00e9rifie que les checkboxes refl\u00e8tent l'\u00e9tat du cache.\"\"\"\n\n    def test_add_playlist_transaction(self):\n        \"\"\"V\u00e9rifie l'ajout d'une piste \u00e0 une playlist.\"\"\"\n\n    def test_remove_playlist_transaction(self):\n        \"\"\"V\u00e9rifie le retrait d'une piste d'une playlist.\"\"\"\n\n    def test_api_error_rollback(self):\n        \"\"\"V\u00e9rifie le rollback en cas d'erreur API.\"\"\"\n\n\nclass TestPlaylistColumnDelegate(unittest.TestCase):\n    \"\"\"Tests du delegate personnalis\u00e9.\"\"\"\n\n    def test_state_pending_spinner_rendering(self):\n        \"\"\"V\u00e9rifie le rendu du spinner en \u00e9tat PENDING.\"\"\"\n\n    def test_state_ready_button_rendering(self):\n        \"\"\"V\u00e9rifie le rendu du bouton en \u00e9tat READY.\"\"\"\n\n    def test_state_transition_pending_to_ready(self):\n        \"\"\"V\u00e9rifie la transition d'\u00e9tat PENDING \u2192 READY.\"\"\"\n\n    def test_click_opens_dialog(self):\n        \"\"\"V\u00e9rifie que le clic ouvre le dialogue.\"\"\"\n\n\nclass TestThreadSafePlaylistCache(unittest.TestCase):\n    \"\"\"Tests du cache thread-safe.\"\"\"\n\n    def test_concurrent_reads_no_deadlock(self):\n        \"\"\"V\u00e9rifie les lectures concurrentes.\"\"\"\n\n    def test_add_track_to_playlist(self):\n        \"\"\"V\u00e9rifie l'ajout d'une piste.\"\"\"\n\n    def test_remove_track_from_playlist(self):\n        \"\"\"V\u00e9rifie le retrait d'une piste.\"\"\"\n\n    def test_contains_check_o1_performance(self):\n        \"\"\"V\u00e9rifie la complexit\u00e9 O(1) des v\u00e9rifications.\"\"\"\n</code></pre>"},{"location":"playlist_membership_manager/#62-metriques-de-qualite","title":"6.2 M\u00e9triques de qualit\u00e9","text":"<ul> <li>Coverage cible : \u2265 85% (tests/test_playlist_manager.py)</li> <li>Linting : <code>make check</code> doit passer (Black, isort, Flake8)</li> <li>Type checking : <code>mypy</code> sans errors</li> <li>Performance : Cache lookup &lt; 1ms, Dialog appearance &lt; 50ms</li> </ul>"},{"location":"playlist_membership_manager/#7-dictionnaire-derreurs","title":"7. Dictionnaire d'erreurs","text":"Code Signification Action 401 Non authentifi\u00e9 Redirection login 403 Pas de permission Toast silencieux 404 Playlist non trouv\u00e9e Log + continue 429 Rate limited Backoff exponentiel 500+ Erreur serveur Retry automatique (3x) Timeout D\u00e9passement d\u00e9lai Abort + log"},{"location":"playlist_membership_manager/#8-resume-des-fichiers-a-creer","title":"8. R\u00e9sum\u00e9 des fichiers \u00e0 cr\u00e9er","text":"<ol> <li>tidal_dl_ng/gui/playlist_membership.py</li> <li><code>ThreadSafePlaylistCache</code></li> <li><code>PlaylistContextLoader</code></li> <li> <p><code>PlaylistColumnDelegate</code></p> </li> <li> <p>tidal_dl_ng/gui/dialog_playlist_manager.py</p> </li> <li> <p><code>PlaylistManagerDialog</code></p> </li> <li> <p>tests/test_playlist_manager.py</p> </li> <li> <p>Tests exhaustifs</p> </li> <li> <p>docs/playlist_membership_manager.md (ce fichier)</p> </li> <li> <p>Modifications \u00e0 tidal_dl_ng/gui/main_window.py</p> </li> <li>Int\u00e9gration des signaux et initialization</li> </ol>"},{"location":"playlist_membership_manager/#9-chronologie-estimee","title":"9. Chronologie estim\u00e9e","text":"<ul> <li>Phase 1 : Backend (Worker + Cache) : 4-5h</li> <li>Phase 2 : UI (Delegate + Dialog) : 3-4h</li> <li>Phase 3 : Tests + Int\u00e9gration : 2-3h</li> <li>Total : ~10-12h</li> </ul>"},{"location":"refactor_settings_ui/","title":"Settings Window Refactor","text":"<p>Date: 2025-11-30 Author: Automation (Copilot)</p>"},{"location":"refactor_settings_ui/#goal","title":"Goal","text":"<p>Refactor the settings window to improve usability and maintainability:</p> <ul> <li>Category list on the left</li> <li>Settings content on the right via QStackedWidget</li> <li>Clear separation of pages (Flags, Quality, Numbers, Paths &amp; Formats, Delimiters)</li> <li>Consistent dark styling and tuned spacing</li> <li>Add unit and integration tests (61 total)</li> </ul>"},{"location":"refactor_settings_ui/#key-changes","title":"Key Changes","text":""},{"location":"refactor_settings_ui/#1-ui-architecture","title":"1. UI Architecture","text":"<ul> <li>Navigation column: <code>QListWidget (lw_categories)</code></li> <li>Pages container: <code>QStackedWidget (sw_categories)</code></li> <li>Pages created:</li> <li><code>page_flags</code> (GroupBox: gb_flags)</li> <li><code>page_quality</code> (GroupBox: gb_choices)</li> <li><code>page_numbers</code> (GroupBox: gb_numbers)</li> <li><code>page_paths</code> (GroupBox: gb_path)</li> <li><code>page_delimiters</code> (GroupBox: gb_delimiters) \u2014 NEW</li> </ul> <p>Impacted file: <code>tidal_dl_ng/ui/dialog_settings.ui</code> (auto-generated <code>dialog_settings.py</code>).</p>"},{"location":"refactor_settings_ui/#2-new-category-delimiters","title":"2. New Category: Delimiters","text":"<ul> <li>\"Delimiters\" page with 4 <code>QLineEdit</code> fields to edit separators:</li> <li><code>metadata_delimiter_artist</code></li> <li><code>metadata_delimiter_album_artist</code></li> <li><code>filename_delimiter_artist</code></li> <li><code>filename_delimiter_album_artist</code></li> <li>Automatic integration with <code>DialogPreferences</code> through <code>parameters_line_edit</code>, <code>populate_line_edit()</code> and <code>to_settings()</code>.</li> </ul> <p>Files touched:</p> <ul> <li><code>tidal_dl_ng/ui/dialog_settings.ui</code> (new page)</li> <li><code>tidal_dl_ng/ui/dialog_settings.py</code> (regenerated)</li> <li><code>tidal_dl_ng/dialog.py</code> (added 4 parameters and new category in <code>_init_categories</code>).</li> </ul>"},{"location":"refactor_settings_ui/#3-styles-spacing","title":"3. Styles &amp; Spacing","text":"<ul> <li>Category list: dark style, blue selection, gray hover, light text.</li> <li>Vertical spacing: list item margin <code>2px 0px</code> (and optional view spacing).</li> <li>Settings area: dark background (QStackedWidget), styled GroupBoxes.</li> </ul> <p>Files touched:</p> <ul> <li><code>tidal_dl_ng/ui/dialog_settings.ui</code> (stylesheets on lw_categories and sw_categories)</li> <li><code>tidal_dl_ng/ui/dialog_settings.py</code> (regenerated).</li> </ul>"},{"location":"refactor_settings_ui/#4-tests","title":"4. Tests","text":"<ul> <li>New files:</li> <li><code>tests/test_settings_ui.py</code>: UI and basic integration (14)</li> <li><code>tests/test_settings_dialog_structure.py</code>: detailed structure (20)</li> <li><code>tests/test_dialog_preferences_integration.py</code>: DialogPreferences integration (14)</li> <li><code>tests/test_delimiters_category.py</code>: Delimiters page (13)</li> <li>Total: 61 tests; ruff/black/pyupgrade applied via pre-commit.</li> </ul>"},{"location":"refactor_settings_ui/#5-pre-commit-quality","title":"5. Pre-commit &amp; Quality","text":"<ul> <li>Ruff fixes:</li> <li>F841 (unused variable) in <code>test_dialog_preferences_integration.py</code></li> <li>S108 (using /tmp) replaced by <code>Path.home()</code> and safe values</li> <li>end-of-file-fixer and black reformatted automatically.</li> </ul>"},{"location":"refactor_settings_ui/#usage","title":"Usage","text":""},{"location":"refactor_settings_ui/#launch-the-ui","title":"Launch the UI","text":"<ul> <li>Via the app: <code>poetry run tidal-dl-ng-gui</code> (or <code>python -m tidal_dl_ng.gui</code>)</li> </ul>"},{"location":"refactor_settings_ui/#navigate","title":"Navigate","text":"<ul> <li>Select a category in <code>lw_categories</code></li> <li>The corresponding page shows in <code>sw_categories</code>.</li> </ul>"},{"location":"refactor_settings_ui/#edit-separators","title":"Edit separators","text":"<ul> <li>Open the \"Delimiters\" category</li> <li>Edit fields <code>le_metadata_delimiter_*</code> and <code>le_filename_delimiter_*</code></li> <li>Confirm via OK</li> </ul>"},{"location":"refactor_settings_ui/#known-issue-poetrydulwich-keyerror-bhead","title":"Known issue: poetry+dulwich KeyError b'HEAD","text":"<ul> <li>Cause: dulwich cannot resolve HEAD in the Git repo when Poetry queries VCS info.</li> <li>Fix: ensure <code>.git/HEAD</code> points to an existing branch (e.g. <code>ref: refs/heads/main</code>) and the branch exists; then re-run <code>poetry install</code>. See commands below.</li> </ul>"},{"location":"refactor_settings_ui/#useful-commands-powershell","title":"Useful Commands (PowerShell)","text":"<pre><code>cd C:\\Users\\mathe\\PycharmProjects\\tidal-dl-ng\npoetry check --lock\npoetry run pre-commit run -a\npytest -q\n</code></pre> <p>To fix HEAD if needed:</p> <pre><code>cd C:\\Users\\mathe\\PycharmProjects\\tidal-dl-ng\nGet-Content .git\\HEAD\n# If empty/incorrect:\ngit init\ngit add .\ngit commit -m \"Initialize repo for Poetry/Dulwich\"\ngit branch -M main\nGet-Content .git\\HEAD\npoetry install -vvv --no-interaction --all-extras --with dev,docs\n</code></pre>"},{"location":"refactor_settings_ui/#impact","title":"Impact","text":"<ul> <li>Better UX: category navigation, improved readability</li> <li>Extensible: easy to add new pages/settings</li> <li>Quality: comprehensive tests ensure robustness</li> </ul>"},{"location":"refactor_settings_ui/#next-steps","title":"Next Steps","text":"<ul> <li>Add contextual help (tooltips) for new delimiter fields</li> <li>Optionally adjust list spacing (8\u201310) based on feedback</li> <li>Add a preview of resulting formatting (e.g., sample metadata)</li> </ul>"},{"location":"testing_summary/","title":"Created Tests and Results","text":""},{"location":"testing_summary/#test-files","title":"Test files","text":"<ul> <li><code>tests/test_settings_ui.py</code> (14 tests)</li> <li><code>tests/test_settings_dialog_structure.py</code> (20 tests)</li> <li><code>tests/test_dialog_preferences_integration.py</code> (14 tests)</li> <li><code>tests/test_delimiters_category.py</code> (13 tests)</li> </ul>"},{"location":"testing_summary/#total","title":"Total","text":"<ul> <li>61 tests (unit + integration)</li> </ul>"},{"location":"testing_summary/#coverage","title":"Coverage","text":"<ul> <li>UI creation and structure</li> <li>Category navigation</li> <li>Widgets presence and accessibility</li> <li>New \"Delimiters\" page</li> <li>Quality: ruff/black/pyupgrade enforced by pre-commit</li> </ul>"},{"location":"testing_summary/#commands","title":"Commands","text":"<pre><code>cd C:\\Users\\mathe\\PycharmProjects\\tidal-dl-ng\npoetry run pre-commit run -a\npytest -q\n</code></pre>"},{"location":"testing_summary/#note","title":"Note","text":"<p>If <code>poetry install</code> fails with KeyError b'HEAD, see \"Settings Window Refactor\" doc to fix the Git repo\u2019s HEAD.</p>"},{"location":"ui_styles/","title":"UI Styles (Dark)","text":""},{"location":"ui_styles/#category-list-qlistwidget","title":"Category List (QListWidget)","text":"<ul> <li>Background: <code>#2b2b2b</code></li> <li>Selection: blue <code>#3d5a80</code> + white text</li> <li>Hover: gray <code>#3a3a3a</code></li> <li>Text: light gray <code>#e0e0e0</code></li> <li>Padding: 4px</li> <li>Item margin: 2px vertical</li> <li>View spacing: 0 (can be set to 6\u201310 for more breathing room)</li> </ul>"},{"location":"ui_styles/#settings-area-qstackedwidget","title":"Settings Area (QStackedWidget)","text":"<ul> <li>Background: <code>#333333</code></li> <li>Border: <code>#3d3d3d</code></li> <li>GroupBox: background <code>#3a3a3a</code>, border <code>#4a4a4a</code>, radius 6</li> </ul>"},{"location":"ui_styles/#tuning-tips","title":"Tuning Tips","text":"<ul> <li>Increase view spacing to 8\u201310 if preferred visually</li> <li>Harmonize corner radius with global UI style</li> <li>Use tooltips to explain parameters</li> </ul>"}]}